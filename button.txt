#define ButtonRead() HAL_GPIO_ReadPin(USER_Btn_GPIO_Port, USER_Btn_Pin)

static void MX_TIM8_Init(void);
uint8_t state = 0; 		// состояние кнопки 1 - нажата
uint8_t counter = 0; 		// счетчик нажатий
uint8_t cheсk = 0;		// проверка состояния 1 - ожидается проверка состояния кнопки
uint8_t t0 = 0;			// промежуточное время
uint8_t dt = 10;		// период проверки состояния кнопки
uint_8_t a = 0;			// промежуточное состояние кнопки

HAL_TIM_Base_Start_IT(&htim8)
while (1)
{
	if cheсk					// нужно ли повторно проверять состояние кнопки?
	{						// повторно проверяем состояние кнопки
		if (TIM8->CCR1 - t0 >= dt)			// прошло ли достаточно времени?
		{					
			if ButtonRead() = a		// если через время dt состояние кнопки совпадает с промежуточным
			{
				state = a		// меняем состояние кнопки
				cheсk = 0		// выключаем ожидание проверки
			}
		}
	}

	else						// повторно не проверяем состояние кнопки
	{
		if ButtonRead() != state		// первично проверяем состояние кнопки
		{
		cheсk = 1				// включаем ожидание проверки
		a = ButtonRead()			// запоминаем промежуточное состояние
		t0 = TIM8->CCR1				// запоминаем промежуточное время
		}		

	}
}
